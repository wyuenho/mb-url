---
{
   "kind": "pipeline",
   "name": "default",
   "services": [
      {
         "image": "kennethreitz/httpbin",
         "name": "httpbin"
      }
   ],
   "steps": [
      {
         "commands": [
            "apt-get update",
            "apt-get install --yes locales",
            "echo \"en_US.UTF-8 UTF-8\" > /etc/locale.gen",
            "locale-gen"
         ],
         "image": "buildpack-deps:stable",
         "name": "install locales",
         "volumes": [
            {
               "name": "locales",
               "path": "/usr/lib/locale"
            }
         ]
      },
      {
         "commands": [
            "nix-env -i curl httpie",
            "nix-env -iA nixpkgs.python3Packages.pipx",
            "pipx run --spec exodus-bundler exodus --tarball curl http https | tar x -z -f - -C /opt/exodus --strip-components=1"
         ],
         "depends_on": [
            "install locales"
         ],
         "image": "nixos/nix:latest",
         "name": "install ci deps",
         "volumes": [
            {
               "name": "exodus",
               "path": "/opt/exodus"
            }
         ]
      },
      {
         "commands": [
            "export PATH=/opt/exodus/bin:$PATH",
            "cask install",
            "sleep 15",
            "cask exec ert-runner"
         ],
         "depends_on": [
            "install ci deps"
         ],
         "environment": {
            "MB_URL_TEST__HTTPBIN_PREFIX": "http://httpbin"
         },
         "image": "silex/emacs:24.5-ci-cask",
         "name": "test-emacs24.5",
         "volumes": [
            {
               "name": "locales",
               "path": "/usr/lib/locale"
            },
            {
               "name": "exodus",
               "path": "/opt/exodus"
            }
         ]
      },
      {
         "commands": [
            "export PATH=/opt/exodus/bin:$PATH",
            "cask install",
            "sleep 15",
            "cask exec ert-runner"
         ],
         "depends_on": [
            "install ci deps"
         ],
         "environment": {
            "MB_URL_TEST__HTTPBIN_PREFIX": "http://httpbin"
         },
         "image": "silex/emacs:25.1-ci-cask",
         "name": "test-emacs25.1",
         "volumes": [
            {
               "name": "locales",
               "path": "/usr/lib/locale"
            },
            {
               "name": "exodus",
               "path": "/opt/exodus"
            }
         ]
      },
      {
         "commands": [
            "export PATH=/opt/exodus/bin:$PATH",
            "cask install",
            "sleep 15",
            "cask exec ert-runner"
         ],
         "depends_on": [
            "install ci deps"
         ],
         "environment": {
            "MB_URL_TEST__HTTPBIN_PREFIX": "http://httpbin"
         },
         "image": "silex/emacs:25.2-ci-cask",
         "name": "test-emacs25.2",
         "volumes": [
            {
               "name": "locales",
               "path": "/usr/lib/locale"
            },
            {
               "name": "exodus",
               "path": "/opt/exodus"
            }
         ]
      },
      {
         "commands": [
            "export PATH=/opt/exodus/bin:$PATH",
            "cask install",
            "sleep 15",
            "cask exec ert-runner"
         ],
         "depends_on": [
            "install ci deps"
         ],
         "environment": {
            "MB_URL_TEST__HTTPBIN_PREFIX": "http://httpbin"
         },
         "image": "silex/emacs:25.3-ci-cask",
         "name": "test-emacs25.3",
         "volumes": [
            {
               "name": "locales",
               "path": "/usr/lib/locale"
            },
            {
               "name": "exodus",
               "path": "/opt/exodus"
            }
         ]
      },
      {
         "commands": [
            "export PATH=/opt/exodus/bin:$PATH",
            "cask install",
            "sleep 15",
            "cask exec ert-runner"
         ],
         "depends_on": [
            "install ci deps"
         ],
         "environment": {
            "MB_URL_TEST__HTTPBIN_PREFIX": "http://httpbin"
         },
         "image": "silex/emacs:26.1-ci-cask",
         "name": "test-emacs26.1",
         "volumes": [
            {
               "name": "locales",
               "path": "/usr/lib/locale"
            },
            {
               "name": "exodus",
               "path": "/opt/exodus"
            }
         ]
      },
      {
         "commands": [
            "export PATH=/opt/exodus/bin:$PATH",
            "cask install",
            "sleep 15",
            "cask exec ert-runner"
         ],
         "depends_on": [
            "install ci deps"
         ],
         "environment": {
            "MB_URL_TEST__HTTPBIN_PREFIX": "http://httpbin"
         },
         "image": "silex/emacs:26.2-ci-cask",
         "name": "test-emacs26.2",
         "volumes": [
            {
               "name": "locales",
               "path": "/usr/lib/locale"
            },
            {
               "name": "exodus",
               "path": "/opt/exodus"
            }
         ]
      },
      {
         "commands": [
            "export PATH=/opt/exodus/bin:$PATH",
            "cask install",
            "sleep 15",
            "cask exec ert-runner"
         ],
         "depends_on": [
            "install ci deps"
         ],
         "environment": {
            "MB_URL_TEST__HTTPBIN_PREFIX": "http://httpbin"
         },
         "image": "silex/emacs:26.3-ci-cask",
         "name": "test-emacs26.3",
         "volumes": [
            {
               "name": "locales",
               "path": "/usr/lib/locale"
            },
            {
               "name": "exodus",
               "path": "/opt/exodus"
            }
         ]
      }
   ],
   "volumes": [
      {
         "name": "locales",
         "temp": { }
      },
      {
         "name": "exodus",
         "temp": { }
      }
   ]
}
---
{
   "kind": "pipeline",
   "name": "test for emacs 24.4",
   "services": [
      {
         "image": "kennethreitz/httpbin",
         "name": "httpbin"
      }
   ],
   "steps": [
      {
         "commands": [
            "apt-get update",
            "apt-get install --yes locales",
            "locale-gen en_US.UTF-8"
         ],
         "image": "ubuntu:12.04",
         "name": "install locales",
         "volumes": [
            {
               "name": "locales",
               "path": "/usr/lib/locale"
            }
         ]
      },
      {
         "commands": [
            "nix-env -i curl httpie",
            "nix-env -iA nixpkgs.python3Packages.pipx",
            "pipx run --spec exodus-bundler exodus --tarball curl http https | tar x -z -f - -C /opt/exodus --strip-components=1"
         ],
         "depends_on": [
            "install locales"
         ],
         "image": "nixos/nix:latest",
         "name": "install ci deps",
         "volumes": [
            {
               "name": "exodus",
               "path": "/opt/exodus"
            }
         ]
      },
      {
         "commands": [
            "export PATH=/opt/exodus/bin:$PATH",
            "cask install",
            "sleep 15",
            "cask exec ert-runner"
         ],
         "depends_on": [
            "install ci deps"
         ],
         "environment": {
            "MB_URL_TEST__HTTPBIN_PREFIX": "http://httpbin"
         },
         "image": "silex/emacs:24.4-ci-cask",
         "name": "test-emacs24.4",
         "volumes": [
            {
               "name": "locales",
               "path": "/usr/lib/locale"
            },
            {
               "name": "exodus",
               "path": "/opt/exodus"
            }
         ]
      }
   ],
   "volumes": [
      {
         "name": "locales",
         "temp": { }
      },
      {
         "name": "exodus",
         "temp": { }
      }
   ]
}
...
